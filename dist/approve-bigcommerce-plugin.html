
<script>
	/**
	 * Startup Variables:
	 *     Set applicible values needed to connect the plugin to your KWIPPED APPROVE account
	 *     If you do not have your account setup yet goto www.kwipped.com to get started
	 */
	window.kwipped_approve = window.kwipped_approve || {};
	/**
	 * Set: 
	 * 	@param {kwipped_approve.url} string set to the base kwipped url 
	 *      found in the plugin configurator in your KWIPPED APPROVE account
	 * 	@param {kwipped_approve.approve_id} string set to the value found
	 *      in the plugin configurator in your KWIPPED APPROVE account
	 */
	kwipped_approve.url = "https://www.kwipped.com";
	kwipped_approve.approve_id = "eyJpdiI6ImxEeENtRHFKdWdtMHp3K21uckFcL2RnPT0iLCJ2YWx1ZSI6IitYMmJmejNkZDNaak82QW9iNXVwc1E9PSIsIm1hYyI6ImQ1MjZjODFkYWI3M2JiOTRhNDBiYWM0MDk3ODVkY2Q5NGI4M2FkOTI2NWEzZWEyYTA4NzNlMTJlNDQ3NGNkYzEifQ==";

	// setup bc_app object
	kwipped_approve.bc_app = {};

	/**
	 * CONFIG OPTIONS:
	 * Set these values to the appropriate settings to interact between your page(s) and the finance button
	 */
	kwipped_approve.bc_app.config = {
		
		// the button_amt_threshold is the dollar amount at which a apply for finance button is shown
		button_amt_threshold: 2000,
		
		// the cart_amt_threshold is the cart dollar amount total at which a apply for finance button is shown on the cart
		// this is only applicible if you add a finance button to the cart
		cart_amt_threshold: 2000,


		product_info_wrap: ".productView",
		product_price_ele: ".productView [data-product-price-without-tax]:first",
		qty_ele: 'input[name="qty[]"]',
		qty_down_ele: 'button[data-action="dec"]',
		qty_up_ele: 'button[data-action="inc"]',
	}
	/* ================ APPROVE BigCommerce Helper Functions ================ */
	/* ================ kwipped_approve.bc_app.init ================ */
	kwipped_approve.bc_app.init = function () {

		/**
		 *
		 */

		if ($(kwipped_approve.bc_app.config.product_info_wrap).length > 0
			&& $(kwipped_approve.bc_app.config.qty_ele).length > 0 
		) {
			/**
			 * 
			 */
			var cur_qty_count = $(kwipped_approve.bc_app.config.qty_ele).val(),
				approve_button_parent_ele = $(kwipped_approve.bc_app.config.qty_ele).closest(kwipped_approve.bc_app.config.product_info_wrap),
				product_approve_single_button = approve_button_parent_ele.find('[approve-function="embedded_app"][approve-action="add_to_app"][approve-price]'),
				product_approve_items_button = approve_button_parent_ele.find('[approve-function="embedded_app"][approve-action="add_to_app"][approve-items]'),
				approve_button_price_ele = approve_button_parent_ele.find('[data-product-price-without-tax]'),
				approve_button_price = 0;

			/**
			 * 
			 */
			$(kwipped_approve.bc_app.config.qty_down_ele).click(function () {
				cur_qty_count = (cur_qty_count > 1) ? Number(cur_qty_count) - 1 : 1;
				if (product_approve_single_button.length > 0) {
					product_approve_single_button.attr("approve-qty", cur_qty_count);
				}
			 });

			/**
			 * 
			 */
			$(kwipped_approve.bc_app.config.qty_up_ele).click(function () {
				cur_qty_count = Number(cur_qty_count) + 1;
				if (product_approve_single_button.length > 0) {
					product_approve_single_button.attr("approve-qty", cur_qty_count);
				}
			});

			/**
			 * 
			 */
			$("body").on('DOMSubtreeModified', kwipped_approve.bc_app.config.product_price_ele, function(){
				approve_button_price = approve_button_price_ele.text().replace(/[^\d\.]+/g,"");
				if (approve_button_price != "") {
					if (product_approve_single_button.length > 0) {
						product_approve_single_button.attr("approve-price", approve_button_price);
						product_approve_single_button.find('[approve-function="teaser_rate"]').attr("approve-total", approve_button_price);
					}
					kwipped_approve.bc_app.approve_button_show_hide(product_approve_button);
				}
			});

			/**
			 * 
			 */
			kwipped_approve.bc_app.approve_button_show_hide();
		}
	};

	/* ================ kwipped_approve.bc_app.approve_button_show_hide ================ */
	kwipped_approve.bc_app.approve_button_show_hide = function (ele) {
		var ele = ele || $('[approve-function="embedded_app"][approve-action="add_to_app"][approve-price], [approve-function="embedded_app"][approve-action="add_to_app"][approve-items]');
		ele.each(function (){
			var this_ele = $(this),
				this_grand_total = 0,
				this_total = 0;

			if ($(this)[0].hasAttribute("approve-items")) {
				var items = decodeURIComponent(JSON.parse($(this).attr("approve-items")));
				for (var i in items) {
					var this_item = items[i];
					this_grand_total += Number(this_item.price) * Number(this_item.quantity);
				}
			} else {
				this_grand_total += Number(this_ele.attr("approve-price")) * Number(this_ele.attr("approve-quantity"));
			}
			if (this_grand_total >= kwipped_approve.bc_app.config.button_amt_threshold) {
				if (!this_ele.is(":visible")) {
					this_ele.show();
				}
			} else {
				this_ele.hide();
			}
		});
	};
	
	/* ================ kwipped_approve.bc_app.approve_button_add_items ================ */
	kwipped_approve.bc_app.approve_button_add_items = function (ele, items) {
		ele.attr("approve-items", encodeURIComponent(JSON.stringify(items)));
		kwipped_approve.bc_app.approve_button_show_hide(ele);
	};
	
	/* ================ kwipped_approve.bc_app.approve_button_add_item ================ */
	kwipped_approve.bc_app.approve_button_add_item = function (ele, item) {
		var items = decodeURIComponent(JSON.parse(ele.attr("approve-items")));
		items.push(item);
		ele.attr("approve-items", encodeURIComponent(JSON.stringify(items)));
		kwipped_approve.bc_app.approve_button_show_hide(ele);
	};

	/* ================ kwipped_approve.bc_app.approve_button_update_items ================ */
	kwipped_approve.bc_app.approve_button_update_items = function (ele, item, index) {
		var index = index | 0,
			items = decodeURIComponent(JSON.parse(ele.attr("approve-items")));
		items[index] = item;
		ele.attr("approve-items", encodeURIComponent(JSON.stringify(items)));
		kwipped_approve.bc_app.approve_button_show_hide(ele);
	};


	/* ================ kwipped_approve_jqcheck ================ */
	var kwipped_approve_jqcheck = function (){
		if(window.jQuery)  {
			kwipped_approve.bc_app.init();
		} else {   
			var script = document.createElement('script'); 
			document.body.appendChild(script);  
			script.type = 'text/javascript';
			script.src = "https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js";
			script.onload = function () {
				kwipped_approve.bc_app.init();
			}
		}
	};
	kwipped_approve_jqcheck();
	</script>
	<script src="https://api.kwipped.com/approve/plugin/2.0/approve_plugin_loader.php"></script>